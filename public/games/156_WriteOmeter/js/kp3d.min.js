/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

!function(){var t,e,i;!function(n){function s(t,e){return k.call(t,e)}function o(t,e){var i,n,s,o,r,a,h,l,c,p,d,u,m=e&&e.split("/"),f=b.map,g=f&&f["*"]||{};if(t){for(t=t.split("/"),r=t.length-1,b.nodeIdCompat&&C.test(t[r])&&(t[r]=t[r].replace(C,"")),"."===t[0].charAt(0)&&m&&(u=m.slice(0,m.length-1),t=u.concat(t)),c=0;c<t.length;c++)if("."===(d=t[c]))t.splice(c,1),c-=1;else if(".."===d){if(0===c||1===c&&".."===t[2]||".."===t[c-1])continue;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}if((m||g)&&f){for(i=t.split("/"),c=i.length;c>0;c-=1){if(n=i.slice(0,c).join("/"),m)for(p=m.length;p>0;p-=1)if((s=f[m.slice(0,p).join("/")])&&(s=s[n])){o=s,a=c;break}if(o)break;!h&&g&&g[n]&&(h=g[n],l=c)}!o&&h&&(o=h,a=l),o&&(i.splice(0,a,o),t=i.join("/"))}return t}function r(t,e){return function(){var i=E.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),m.apply(n,i.concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function h(t){return function(e){v[t]=e}}function l(t){if(s(y,t)){var e=y[t];delete y[t],w[t]=!0,u.apply(n,e)}if(!s(v,t)&&!s(w,t))throw new Error("No "+t);return v[t]}function c(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function p(t){return t?c(t):[]}function d(t){return function(){return b&&b.config&&b.config[t]||{}}}var u,m,f,g,v={},y={},b={},w={},k=Object.prototype.hasOwnProperty,E=[].slice,C=/\.js$/;f=function(t,e){var i,n=c(t),s=n[0],r=e[1];return t=n[1],s&&(s=o(s,r),i=l(s)),s?t=i&&i.normalize?i.normalize(t,a(r)):o(t,r):(t=o(t,r),n=c(t),s=n[0],t=n[1],s&&(i=l(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},g={require:function(t){return r(t)},exports:function(t){var e=v[t];return void 0!==e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:d(t)}}},u=function(t,e,i,o){var a,c,d,u,m,b,k,E=[],C=typeof i;if(o=o||t,b=p(o),"undefined"===C||"function"===C){for(e=!e.length&&i.length?["require","exports","module"]:e,m=0;m<e.length;m+=1)if(u=f(e[m],b),"require"===(c=u.f))E[m]=g.require(t);else if("exports"===c)E[m]=g.exports(t),k=!0;else if("module"===c)a=E[m]=g.module(t);else if(s(v,c)||s(y,c)||s(w,c))E[m]=l(c);else{if(!u.p)throw new Error(t+" missing "+c);u.p.load(u.n,r(o,!0),h(c),{}),E[m]=v[c]}d=i?i.apply(v[t],E):void 0,t&&(a&&a.exports!==n&&a.exports!==v[t]?v[t]=a.exports:d===n&&k||(v[t]=d))}else t&&(v[t]=i)},t=e=m=function(t,e,i,s,o){if("string"==typeof t)return g[t]?g[t](e):l(f(t,p(e)).f);if(!t.splice){if(b=t,b.deps&&m(b.deps,b.callback),!e)return;e.splice?(t=e,e=i,i=null):t=n}return e=e||function(){},"function"==typeof i&&(i=s,s=o),s?u(n,t,e,i):setTimeout(function(){u(n,t,e,i)},4),m},m.config=function(t){return m(t)},t._defined=v,i=function(t,e,i){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(i=e,e=[]),s(v,t)||s(y,t)||(y[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("libs/almond",function(){}),i("rs/three/BaseApp",[],function(){"use strict";function t(t,e,i){this.width=t||1e3,this.height=e||600,this.fov=i||60,this.init()}return t.prototype.init=function(){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(this.fov,this.width/this.height,100,3e4);var t=this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});t.setSize(this.width,this.height),t.setPixelRatio(window.devicePixelRatio),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.el=t.domElement,this.raycaster=new THREE.Raycaster},t.prototype._renderRequest=function(t){this.renderer.render(this.scene,this.camera),this.rId=requestAnimationFrame(this._renderRequest.bind(this))},t.prototype.startRendering=function(){this.stopRendering(),this.rId=requestAnimationFrame(this._renderRequest.bind(this))},t.prototype.stopRendering=function(){cancelAnimationFrame(this.rId)},t.prototype.resizeHandler=function(){this.thfov=Math.tan(this.camera.fov*Math.PI/360)},t.prototype.setCameraMatchProjection=function(t){t=t||1;var e=this.camera,i=.5*this.height/Math.tan(e.fov*Math.PI/360);e.position.x=e.position.y=0,e.position.z=i/t,e.lookAt(new THREE.Vector3(0,0,0))},t.prototype._getScaleFitRatio=function(t,e,i){i=i||.75;var n=t/e;return this.width/n>this.height?this.height*i/e:this.width*i/t},t.prototype.getScaleFitPositionZ=function(t,e,i){this.setCameraMatchProjection();var n=this._getScaleFitRatio(t,e,i),s=this.camera.position.z;return s-s/n},t}),i("rs/kp3d/Preferences",[],function(){"use strict";function t(t,e){this.dataString=e,this.config=t,this.init(e)}return t.prototype.init=function(t){if(null==t){this.data={name:"kp3d",unlocked:{}};var e=this.config.data.level;for(var i in e)this.data.unlocked[i]=[1];this.data.difficulty=this.config.general.difficulty,this.data.defaultCategory=this.config.general.defaultCategory,this.save()}else this.data=JSON.parse(t)},t.prototype.save=function(){null!=this.data&&localStorage.setItem("kp3d",JSON.stringify(this.data))},t.prototype.isUnlocked=function(t,e){if(0==e)return!0;var i=this.getUnlockCategory(t);return null!=i&&1===i[e]},t.prototype.saveUnlock=function(t,e){var i=this.data.unlocked;void 0==i[t]&&(i[t]=[]),i[t][e]=1,this.save()},t.prototype.saveDifficulty=function(t){this.data.difficulty=t,this.save()},t.prototype.saveDefaultCategory=function(t){this.data.defaultCategory=t,this.save()},t.prototype.getUnlockCategory=function(t){var e=this.data.unlocked;for(var i in e)if(i==t)return e[i];return null},t}),i("rs/kp3d/AssetManager",[],function(){"use strict";function t(t){this.kp3d=t,this.init()}var e="assets/graphics";return t.prototype.init=function(){var t=this.loadingManager=new THREE.LoadingManager,e=this;t.onLoad=function(){e.loaded=!0,console.log("Assets loaded"),e.onLoad&&e.onLoad.call(e)},t.onProgress=function(t,i,n){e.onProgress&&e.onProgress.call(e,t,i,n)},this.soundOn=!0},t.prototype.load=function(){this.loadPatterns(),this.loadAudio(),this.loadTextures()},t.prototype.loadPatterns=function(){var t=(this.kp3d.defaultOptions,this.kp3d.config),i=t.general.paddingPatterns;this.padSet=[];for(var n=0;n<i.length;n++){var s=document.createElement("img");s.class="paddingPattern",s.src=e+"/"+i[n],s.style.display="none",document.body.appendChild(s),this.padSet.push(s)}},t.prototype.loadAudio=function(){function t(t,n){var s=new THREE.Audio(i);return new THREE.AudioLoader(e.loadingManager).load(t,function(t){s.setBuffer(t),n&&n.call(e)}),s}var e=this,i=new THREE.AudioListener;this.kp3d.config.general.useBackgroundMusic&&(this.bgSound=t("assets/sounds/bg.mp3",function(){this.bgSound.setLoop(!0)})),this.piecemove=t("assets/sounds/piecemove.mp3"),this.btnClick=t("assets/sounds/btnClick.mp3"),this.shufflestart=t("assets/sounds/shufflestart.mp3"),this.shuffleend=t("assets/sounds/shuffleend.mp3"),this.firework=t("assets/sounds/firework.mp3"),this.wintune=t("assets/sounds/wintune.mp3")},t.prototype.loadTextures=function(){var t=(this.kp3d.defaultOptions,this),i=this.kp3d.config.general.boardTextures;this.boardTextures=[];for(var n=0;n<i.length;n++)!function(i){new THREE.TextureLoader(t.loadingManager).load(e+"/"+i,function(e){t.boardTextures.push(e)})}(i[n]);new THREE.TextureLoader(t.loadingManager).load(e+"/lensflare.png",function(e){t.fwTexture=e})},t.prototype.toggleSound=function(){this.soundOn=!this.soundOn,this.soundOn?(this.bgSound.setVolume(.8),this.piecemove.setVolume(1),this.btnClick.setVolume(1),this.shufflestart.setVolume(1),this.shuffleend.setVolume(1),this.firework.setVolume(1),this.wintune.setVolume(1)):(this.bgSound.setVolume(0),this.piecemove.setVolume(0),this.btnClick.setVolume(0),this.shufflestart.setVolume(0),this.shuffleend.setVolume(0),this.firework.setVolume(0),this.wintune.setVolume(0))},t}),i("rs/kp3d/ui/HomeScreenHeader",[],function(){"use strict";function t(t){this.hs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-hscreen-header";var e=this.hs.config;this.title=document.createElement("h1"),this.title.className="app-title",this.title.innerHTML=e.strings.APP_TITLE,t.appendChild(this.title),this.info=document.createElement("span"),this.info.className="app-info",this.info.innerHTML=e.strings.APP_INFO,t.appendChild(this.info),this.progress=document.createElement("div"),this.progress.className="app-progress",this.progressInner=document.createElement("div"),this.progressInner.className="app-progress-inner",t.appendChild(this.progress),this.progress.appendChild(this.progressInner),this.setProgress(0),this.logo=document.createElement("img"),this.logo.className="app-logo",this.logo.src="assets/graphics/logo.png",this.logo.onmousedown=function(t){t.preventDefault()},t.appendChild(this.logo)},t.prototype.hideProgress=function(){var t=this.progress;anime({targets:t,opacity:0,easing:"easeOutQuint",complete:function(){t.style.display="none"}})},t.prototype.hideLogo=function(){var t=this.logo,e=this.hs.kp3d.isMobile;anime({targets:t,opacity:0,easing:"easeOutQuint",complete:function(){if(e)return void(t.style.display="none");anime.remove(t),anime({targets:t,width:32,marginTop:20,opacity:1})}})},t.prototype.setProgress=function(t){this.progressInner.style.width=t+"%"},t.prototype.moveTop=function(){this.hideProgress(),this.hideLogo(),anime({targets:this.el,top:0,translateY:0,easing:"easeOutQuint",duration:1200})},t.prototype.center=function(){var t=this.hs.kp3d.assetManager,e=this.el;anime({targets:this.el,top:"50%",translateY:"-50%",duration:1400,update:function(){t.showDelay&&(anime.remove(e),anime({targets:e,top:0,translateY:0,duration:0}))}})},t}),i("rs/kp3d/ui/HomeScreenMenu",[],function(){"use strict";function t(t){this.hs=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-hscreenmenu",this.con=document.createElement("div"),this.con.className="menu-list",t.appendChild(this.con);var e=this.hs.config,i=this.hs;this.addItem(e.strings.NEW_GAME,function(){i.startNewGame()})},t.prototype.addItem=function(t,e){var i=document.createElement("div");i.className="menu-item",i.innerHTML=t,i.style.opacity=0,this.con.appendChild(i);var n=this.hs.kp3d.assetManager;i.addEventListener("click",function(t){e&&e.call(this),n.btnClick.play()})},t.prototype.show=function(){anime({targets:".rs-hscreenmenu .menu-item",opacity:1,easing:"easeOutQuad",delay:anime.stagger(150,{start:500})})},t}),i("rs/game/BasePanel",[],function(){"use strict";function t(t,e){this.width=t||300,this.height=e||300,this.init()}return t.prototype.init=function(){(this.ol=document.createElement("div")).className="rs-game-overlay";var t=this.el=document.createElement("div");t.className="rs-game-panel",t.style.width=this.width+"px",t.style.height=this.height+"px";var e=this.closeBtn=document.createElement("span");e.className="rs-closebtn",e.innerHTML="&times",t.appendChild(e),e.addEventListener("click",this.hide.bind(this))},t.prototype.show=function(){document.body.appendChild(this.ol),document.body.appendChild(this.el),anime.remove(this.el),anime({targets:this.el,opacity:[0,1],duration:800,easing:"easeOutQuint"})},t.prototype.hide=function(){document.body.contains(this.ol)&&document.body.removeChild(this.ol),document.body.contains(this.el)&&document.body.removeChild(this.el)},t.prototype.resize=function(t,e){},t}),i("rs/game/OptionPanel",["rs/game/BasePanel"],function(t){"use strict";function e(e,i){this.data=e,this.callback=i,t.prototype.constructor.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(){function e(t){var e=t.currentTarget.index;n.callback&&n.callback.call(n,e),n.hide()}t.prototype.init.call(this);var i=this.el;i.classList.add("rs-game-optionpanel"),i.style.height="auto";for(var n=this,s=0;s<this.data.length;s++){var o=document.createElement("div");o.className="rs-optionitem",o.innerHTML=this.data[s],o.index=s,o.addEventListener("click",e),i.appendChild(o)}},e}),i("rs/kp3d/ui/SettingPanel",["rs/game/OptionPanel","rs/game/BasePanel"],function(t,e){"use strict";function i(t){this.kp3d=t,this.config=t.config,e.prototype.constructor.call(this)}i.prototype=Object.create(e.prototype),i.prototype.constructor=i;return i.prototype.init=function(){e.prototype.init.call(this);var i=this.el;i.classList.add("rs-kp3d-spanel"),i.style.width="90%",i.style.height="auto",this.settings={difficulty:"EASY",defaultCategory:0};var n=this.container=document.createElement("div");n.className="rs-settingcontainer",i.appendChild(n);var s=this.config.data.level,o=[];for(var r in s)o.push(r);this.cat=o;var a=this,h=this.kp3d.assetManager,l=this.depanel=new t(o,function(t){a.kp3d.pref.saveDefaultCategory(t),a.updateSettingItem(),h.btnClick.play()}),c=this.dpanel=new t(["EASY","NORMAL","HARD"],function(t){a.kp3d.pref.saveDifficulty(t),a.updateSettingItem(),h.btnClick.play()});this.sitem1=this.buildSettingItem("Difficulty",c),this.sitem2=this.buildSettingItem("Default Category",l)},i.prototype.buildSettingItem=function(t,e){var i=this.kp3d.assetManager,n=document.createElement("div");n.className="rs-settingitem";var s=document.createElement("h3");s.innerHTML=t,n.title=s,n.appendChild(s);var o=document.createElement("span");return o.innerHTML="Button",n.btn=o,n.appendChild(o),this.container.appendChild(n),o.addEventListener("click",function(t){e.show(),i.btnClick.play()}),n},i.prototype.show=function(){e.prototype.show.call(this),this.updateSettingItem()},i.prototype.updateSettingItem=function(){var t=this.kp3d.pref,e=["EASY","NORMAL","HARD"];this.sitem1.btn.innerHTML=e[t.data.difficulty],this.sitem2.btn.innerHTML=this.cat[t.data.defaultCategory].toUpperCase()},i}),i("rs/utils/BrowserUtil",[],function(){"use strict";var t={bp:{XS:0,SM:576,MD:768,LG:992,XL:1200,XXL:1500,X3L:1900,X4L:2e3,X5L:3e3},computeStyle:function(t,e,i){return void 0===i&&(i="px"),parseFloat(getComputedStyle(t)[e].replace(i,""))},css:function(t,e){for(var i in e)t.style[i]=e[i]},getPrefix:function(){return t.pf||(window.opera||navigator.userAgent.indexOf(" OPR/")>=0?(t.pf="Webkit",t.browserName="Opera"):"undefined"!=typeof InstallTrigger?(t.pf="Moz",t.browserName="Firefox"):window.safari?(t.pf="Webkit",t.browserName="Safari"):window.chrome?(t.pf="Webkit",t.browserName="Chrome"):document.documentMode?(t.pf="ms",t.browserName="MSIE"):/Edge/.test(navigator.userAgent)?(t.pf="ms",t.browserName="MSIE"):(t.pf="Webkit",t.browserName="Safari"),"Webkit"===t.pf?t.ps="":t.ps="px",""!==t.pf?t.csspf="-"+t.pf.toLowerCase()+"-":t.csspf="",console.log(t.pf)),t.pf},getMouseTouchEvents:function(){return this.isMobile()?{mdown:"touchstart",mmove:"touchmove",mup:"touchend"}:{mdown:"mousedown",mmove:"mousemove",mup:"mouseup"}},isMobile:function(){return void 0===t.imb&&(t.imb=null===document.createElement("span").ontouchstart),t.imb},goFullscreen:function(e){var i=t.isFullscreenSupported();return!!i&&(""===i?e.requestFullScreen():e[i+"RequestFullScreen"]())},exitFullscreen:function(e){var i=t.isFullscreenSupported();return!!i&&(!!t.isFullscreen()&&(""===i?document.cancelFullScreen():document[i+"CancelFullScreen"]()))},fullScreenCallback:function(e,i,n){var s=t.isFullscreenSupported();if(!s)return!1;var o=s+"fullscreenchange";document.addEventListener(o,i)},isFullscreen:function(){var e=t.isFullscreenSupported();if(!e)return!1;switch(e){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[e+"FullScreen"]}},isFullscreenSupported:function(){var e=t.pf.toLowerCase();return void 0!==document.cancelFullScreen?"":void 0!==document[e+"CancelFullScreen"]&&e}};return t}),i("rs/game/Scroller",["rs/utils/BrowserUtil"],function(t){"use strict";function e(e){t.isMobile()?(i="touchstart",n="touchend",s="touchmove"):(i="mousedown",n="mouseup",s="mousemove"),this.el=e,this.el.style.overflow="hidden",this.init()}var i,n,s;return e.prototype.init=function(){function t(){p.scrollTop+=.075*(l-p.scrollTop),d.scrollId=requestAnimationFrame(t)}function e(e){c=e.touches?e.touches[0].clientY:e.clientY,a=c,h=l=p.scrollTop,p.addEventListener(s,o),p.addEventListener(n,r),window.addEventListener(s,o),window.addEventListener(n,r),cancelAnimationFrame(d.scrollId),d.scrollId=requestAnimationFrame(t),p.style.cursor="grab"}function o(t){c=t.changedTouches?t.changedTouches[0].clientY:t.clientY;var e=2.5*(c-a),i=p.scrollHeight-d.el.clientHeight,n=h-e;n>i&&(n=i),n<0&&(n=0),l=n,p.style.cursor="grabbing"}function r(t){p.removeEventListener(s,o),p.removeEventListener(n,r),window.removeEventListener(s,o),window.removeEventListener(n,r),cancelAnimationFrame(d.scrollId),p.style.cursor="grab"}var a,h,l,c,p=this.el,d=this;p.addEventListener(i,e),p.addEventListener("mouseover",function(t){p.style.cursor="grab"})},e}),i("rs/kp3d/ui/HelpPanel",["rs/game/Scroller","rs/game/BasePanel"],function(t,e){"use strict";function i(){e.prototype.constructor.call(this)}i.prototype=Object.create(e.prototype),i.prototype.constructor=i;return i.prototype.init=function(){e.prototype.init.call(this);var i=this.el;i.classList.add("rs-kp3d-helppanel"),i.style.width=i.style.height="90%";var n=this.container=document.createElement("div");n.className="rs-helpcontainer",i.appendChild(n),this.scroller=new t(this.container);var s=new XMLHttpRequest;s.addEventListener("load",function(t){var e=this.responseText;n.innerHTML=e}),s.open("GET","assets/text/helpcontent.html"),s.send()},i}),i("rs/kp3d/ui/CreditPanel",["rs/game/BasePanel"],function(t){"use strict";function e(e){this.kp3d=e,t.prototype.constructor.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.prototype.init.call(this);var e=this.el;e.classList.add("rs-kp3d-cpanel"),e.style.width="90%",e.style.height="auto";var i=this.content=document.createElement("div"),n=this.kp3d.config.strings;i.innerHTML="<h3>"+n.APP_TITLE+"</h3>",i.innerHTML+="<p>"+n.CREDIT_TEXT+"</p>",e.appendChild(i)},e}),i("rs/kp3d/screen/HomeScreen",["rs/kp3d/ui/HomeScreenHeader","rs/kp3d/ui/HomeScreenMenu","rs/kp3d/ui/SettingPanel","rs/kp3d/ui/HelpPanel","rs/kp3d/ui/CreditPanel"],function(t,e,i,n,s){"use strict";function o(t){this.kp3d=t,this.loaded=!1,this.config=t.config,this.init()}return o.prototype.init=function(){var o=this.el=document.createElement("div");o.className="rs-hscreen",o.style.width=o.style.height="100%",o.style.display="none",this.header=new t(this),this.menu=new e(this),this.hpanel=new n,this.cpanel=new s(this.kp3d),this.spanel=new i(this.kp3d)},o.prototype.load=function(){this.el.style.display="block",this.el.appendChild(this.header.el),this.header.center();var t=this.kp3d.assetManager,e=this,i=this.header,n=this.menu;t.onLoad=function(){setTimeout(function(){t.showDelay=!0,i.moveTop(),e.el.appendChild(n.el),n.show(),t.bgSound&&t.bgSound.play()},1500)},t.onProgress=function(t,i,n){e.header.setProgress(i/n*100)},this.kp3d.assetManager.load()},o.prototype.transitionIn=function(){this.el.style.display="block",anime({targets:this.el,translateY:0,easing:"easeOutQuint",opacity:1,duration:1200})},o.prototype.transitionOut=function(){var t=this.el;anime({targets:this.el,translateY:-400,easing:"easeOutQuint",opacity:0,duration:1200,complete:function(){t.style.display="none"}})},o.prototype.show=function(){if(this.kp3d.root.appendChild(this.el),!this.kp3d.assetManager.loaded)return void this.load();this.transitionIn()},o.prototype.hide=function(){this.kp3d.root.removeChild(this.el),this.transitionOut()},o.prototype.startNewGame=function(){this.kp3d.setGameScreen()},o.prototype.showSetting=function(){this.spanel.show()},o.prototype.showHelp=function(){this.hpanel.show()},o.prototype.resize=function(t,e){},o}),i("rs/game/ImagePanel",["rs/game/BasePanel"],function(t){"use strict";function e(){t.prototype.constructor.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.prototype.init.call(this),this.el.classList.add("rs-image-panel");var e=this.img=document.createElement("img");this.el.appendChild(this.img),this.el.style.width=this.el.style.height="auto",e.addEventListener("click",this.hide.bind(this)),e.onload=function(t){var i=e.width/e.height;e.height>=window.innerHeight&&(e.height=.85*window.innerHeight,e.width=e.height*i),e.width>=window.innerWidth&&(e.width=.85*window.innerWidth,e.height=e.width/i)}},e.prototype.show=function(e){this.img.src=e,t.prototype.show.call(this)},e.prototype.load=function(t){},e}),i("rs/game/IconButton",["rs/utils/BrowserUtil"],function(t){"use strict";function e(t,e){this.init(t,e)}return e.prototype.init=function(e,i){var n=this.el=document.createElement("span");n.className=e,t.css(n,{display:"block",cursor:"pointer",borderRadius:"50%",textAlign:"center"});var s=this;i&&n.addEventListener("click",function(t){i.call(s)})},e}),i("rs/kp3d/ui/GameButton",["rs/game/IconButton"],function(t){"use strict";function e(t,e){this.init(t,e)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.el.classList.add("rs-kp3d-mainbutton")},e.prototype.addClass=function(t){this.el.classList.add(t)},e.prototype.removeClass=function(t){this.el.classList.remove(t)},e}),i("rs/kp3d/ui/TrophyPanel",["rs/game/BasePanel","rs/kp3d/ui/GameButton"],function(t,e){"use strict";function i(e){this.gs=e,this.am=e.kp3d.assetManager,t.prototype.constructor.call(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.prototype.init.call(this);var i=this.el;i.classList.add("rs-trophy-panel"),i.style.width=i.style.height="90%",this.title=document.createElement("h1"),this.title.className="trophy-level-title",this.title.innerHTML="Level Up";var n=this.meta=document.createElement("div");n.className="meta-container",i.appendChild(n);var s=this.timespan=document.createElement("span");s.innerHTML="Time: 323s",n.appendChild(s);var o=this.movespan=document.createElement("span");o.innerHTML="Moves: 232",n.appendChild(o);var r=document.createElement("div");r.className="trophy-container";var a=document.createElement("img");a.src="assets/graphics/trophy.png",r.appendChild(a),i.appendChild(r);var h=document.createElement("span");h.className="level-label",h.innerHTML=23,r.appendChild(h),this.lvl=h;var l=this.btnContainer=document.createElement("div");l.className="trophy-button-container",i.appendChild(l),this.replayBtn=new e("icon-undo",this.doReplay.bind(this)),this.replayBtn.addClass("rs-kp3d-mainbutton-extra"),l.appendChild(this.replayBtn.el),this.nextBtn=new e("icon-nextlevel",this.doNext.bind(this)),this.nextBtn.addClass("rs-kp3d-mainbutton-extra"),l.appendChild(this.nextBtn.el)},i.prototype.show=function(){t.prototype.show.call(this),document.body.appendChild(this.title),this.setValues(this.gs.getPlayingTime(),this.gs.getMoveCount(),this.gs.currentLevel+1)},i.prototype.hide=function(){t.prototype.hide.call(this),document.body.contains(this.title)&&document.body.removeChild(this.title)},i.prototype.doReplay=function(){this.am.btnClick.play(),this.gs.replayLevel()},i.prototype.doNext=function(){this.am.btnClick.play(),this.gs.nextLevel()},i.prototype.setValues=function(t,e,i){this.timespan.innerHTML="Times: "+t+"s",this.lvl.innerHTML=i,this.movespan.innerHTML="Moves: "+e},i}),i("rs/kp3d/ui/LevelPanel",["rs/game/Scroller","rs/game/BasePanel"],function(t,e){"use strict";function i(t){this.gs=t,this.am=t.kp3d.assetManager,e.prototype.constructor.call(this),this.currentCategory=-1}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.init=function(){e.prototype.init.call(this);var i=this.el;this.el.classList.add("rs-kp3d-levelpanel"),i.style.width=i.style.height="90%";var n=this.levelTitle=document.createElement("div");n.className="trophy-level-title",n.innerHTML="Levels";var s=this.lgc=document.createElement("div");s.className="rs-kp3d-levelgridcontainer",i.appendChild(s),this.lg=document.createElement("div"),this.lg.className="rs-kp3d-levelgrid",s.appendChild(this.lg),this.scroller=new t(this.lgc)},i.prototype.show=function(){e.prototype.show.call(this),document.body.appendChild(this.levelTitle),this.buildGrid()},i.prototype.hide=function(){e.prototype.hide.call(this),document.body.contains(this.levelTitle)&&document.body.removeChild(this.levelTitle)},i.prototype.buildGrid=function(){function t(t){var i=t.currentTarget.index;o.isUnlocked(e.name,i)&&s.loadLevel(i),s.kp3d.assetManager.btnClick.play()}var e=this.gs.levels[this.gs.currentCategory],i=e.content.length,n=this.lg,s=this.gs,o=this.gs.kp3d.pref;n.textContent="";for(var r=0;r<i;r++){var a=document.createElement("div");a.className="rs-kp3d-levelgriditem",a.index=r,o.isUnlocked(e.name,r)?(a.innerHTML="<span>"+(r+1)+"</span>",a.unlocked=!0):(a.innerHTML='<span class="icon-lock"></span>',a.unlocked=!1),n.appendChild(a),a.addEventListener("click",t)}cancelAnimationFrame(this.scrollId),this.lgc.scrollTop=0;var h=96*Math.floor(this.lg.clientWidth/96);this.lg.style.width=h+"px",this.currentCategory=this.gs.currentCategory},i}),i("rs/kp3d/ui/CategoryPanel",["rs/game/BasePanel"],function(t){"use strict";function e(e){this.gs=e,t.prototype.constructor.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(){function e(t){s.currentCategory!==t.currentTarget.index&&(s.loadCategory(t.currentTarget.index),s.kp3d.assetManager.btnClick.play())}t.prototype.init.call(this);var i=this.el;i.classList.add("rs-kp3d-categorypanel"),i.style.width=i.style.height="auto",this.title=document.createElement("h1"),this.title.className="trophy-level-title",this.title.innerHTML="Category";var n=this.gs.levels,s=this.gs;this.list=[];for(var o=0;o<n.length;o++){var r=n[o],a=document.createElement("div");a.className="rs-categoryitem",a.innerHTML=r.name,a.index=o,a.addEventListener("click",e),this.list.push(a),i.appendChild(a)}},e.prototype.show=function(){t.prototype.show.call(this),document.body.appendChild(this.title);for(var e=this.gs.currentCategory,i=0;i<this.list.length;i++)this.list[i].classList.remove("selected-item");this.list[e].classList.add("selected-item")},e.prototype.hide=function(){t.prototype.hide.call(this),document.body.contains(this.title)&&document.body.removeChild(this.title)},e}),i("rs/kp3d/ui/GameScreenButtonBar",["rs/kp3d/ui/GameButton"],function(t){"use strict";function e(t){this.gs=t,this.init()}return e.prototype.init=function(){var e=this.el=document.createElement("div");e.className="rs-kp3d-gamebuttonbar";this.gs.kp3d.assetManager;this.hintBtn=new t("icon-eye",this.showHint.bind(this)),this.hintBtn.addClass("rs-kp3d-mainbutton-extra"),e.appendChild(this.hintBtn.el),this.levelBtn=new t("icon-stack",this.showGameLevels.bind(this)),this.levelBtn.addClass("rs-kp3d-mainbutton-extra"),e.appendChild(this.levelBtn.el),this.modeBtn=new t("icon-mode",this.showCategory.bind(this)),this.modeBtn.addClass("rs-kp3d-mainbutton-extra"),this.infoBtn=new t("icon-info",this.showHelp.bind(this)),e.appendChild(this.infoBtn.el),this.homeBtn=new t("icon-home",this.showHome.bind(this)),e.appendChild(this.homeBtn.el),this.soundBtn=new t("icon-sound-on",this.toggleSound.bind(this)),this.soundBtn.isOn=!0,e.appendChild(this.soundBtn.el)},e.prototype.show=function(){anime({targets:this.el,bottom:15,easing:"easeOutQuint",duration:800})},e.prototype.hide=function(){anime({targets:this.el,bottom:-50,easing:"easeOutQuint",duration:800})},e.prototype.showHint=function(){var t=this.gs.kp3d.assetManager;this.gs.imagePanel.show(this.gs.getCurrentImagePath()),t.btnClick.play()},e.prototype.showGameLevels=function(){if(!this.gs.game3d.container.isShuffling){this.gs.kp3d.assetManager.btnClick.play(),this.gs.levelPanel.show()}},e.prototype.showCategory=function(t){this.gs.kp3d.assetManager.btnClick.play(),this.gs.catPanel.show()},e.prototype.showHome=function(t){this.gs.kp3d.assetManager.btnClick.play(),this.gs.kp3d.setHomeScreen()},e.prototype.showHelp=function(t){this.gs.kp3d.assetManager.btnClick.play(),this.gs.hpanel.show()},e.prototype.toggleSound=function(){var t=this.gs.kp3d.assetManager,e=this.soundBtn;e.isOn=!this.soundBtn.isOn,e.isOn?(e.removeClass("icon-sound-off"),e.addClass("icon-sound-on"),t.btnClick.play()):(e.removeClass("icon-sound-on"),e.addClass("icon-sound-off")),t.toggleSound()},e.prototype.getClientSize=function(){return[this.el.clientWidth,this.el.clientHeight]},e}),i("rs/kp3d/ui/GameScreenWonBar",["rs/kp3d/ui/GameButton"],function(t){"use strict";function e(t){this.gs=t,this.init()}return e.prototype.init=function(){var e=this.el=document.createElement("div");e.className="rs-kp3d-gamewonbar",e.style.bottom="-85px",this.replayBtn=new t("icon-undo",this.doReplay.bind(this)),this.replayBtn.addClass("rs-kp3d-mainbutton-extra"),e.appendChild(this.replayBtn.el),this.ticon=document.createElement("img"),this.ticon.src="assets/graphics/trophyicon.png",e.appendChild(this.ticon),this.ticon.addEventListener("click",this.showTrophy.bind(this)),this.nextBtn=new t("icon-nextlevel",this.doNext.bind(this)),this.nextBtn.addClass("rs-kp3d-mainbutton-extra"),e.appendChild(this.nextBtn.el)},e.prototype.doReplay=function(){this.gs.kp3d.assetManager.btnClick.play(),this.gs.replayLevel()},e.prototype.doNext=function(){this.gs.kp3d.assetManager.btnClick.play(),this.gs.nextLevel()},e.prototype.showTrophy=function(){this.gs.kp3d.assetManager.btnClick.play(),this.gs.trophyPanel.show()},e.prototype.show=function(){anime({targets:this.el,bottom:12,easing:"easeOutQuint",duration:800})},e.prototype.hide=function(){anime({targets:this.el,bottom:-85,easing:"easeOutQuint",duration:800})},e}),i("rs/kp3d/ui/HeaderTimeButton",[],function(){"use strict";function t(t){this.gh=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-kp3d-timebtn",this.isPlaying=!1,this.currentTime=0;var e=this.gh,i=this;t.addEventListener("click",function(t){e.gs.kp3d.assetManager.btnClick.play(),i.toggleTime()});var n=this.ticon=document.createElement("span");t.appendChild(n),n.className="icon-timer";var s=this.tval=document.createElement("span");s.className="timebtn-value",t.appendChild(s),s.innerHTML="00:00:00";var o=this.tpause=document.createElement("span");o.className="icon-pausetime",t.appendChild(o)},t.prototype.resume=function(){clearInterval(this.timeId),this.timeId=setInterval(this.timeTick.bind(this),1e3),this.isPlaying=!0,this.tpause.className="icon-pausetime"},t.prototype.pause=function(){clearInterval(this.timeId),this.isPlaying=!1,this.tpause.className="icon-playtime"},t.prototype.reset=function(){this.currentTime=0,this.tval.innerHTML="00:00:00"},t.prototype.timeTick=function(){function t(t){return t<10?"0"+t:t}this.currentTime+=1;var e=this.currentTime,i=Math.floor(e/3600),n=Math.floor((e-3600*i)/60),s=(e-3600*i)%60;this.tval.innerHTML=t(i)+":"+t(n)+":"+t(s)},t.prototype.toggleTime=function(){this.gh.gs.game3d.isRunningState()&&(this.isPlaying=!this.isPlaying,this.isPlaying?this.resume():this.pause())},t}),i("rs/kp3d/ui/HeaderLevelButton",[],function(){"use strict";function t(t){this.gh=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-kp3d-levelbtn";var e=this.gh;this.el.addEventListener("click",function(t){e.gs.game3d.shuffle()}),this.label=document.createElement("span"),this.label.className="levelbtn-label",t.appendChild(this.label),this.btn=document.createElement("span"),this.btn.className="levelbtn-shuffle icon-shuffle",t.appendChild(this.btn),this.setLevel(1)},t.prototype.setLevel=function(t){function e(){return Math.floor(150*Math.random())}this.label.innerHTML="Level "+t,this.el.style.backgroundColor="rgba("+e()+", "+e()+", "+e()+", 1)"},t}),i("rs/kp3d/ui/HeaderMoveButton",[],function(){"use strict";function t(t){this.gh=t,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-kp3d-movebtn",this.count=0;var e=this.gh,i=this;t.addEventListener("click",function(t){
e.gs.kp3d.assetManager.btnClick.play(),i.undo()});var n=this.micon=document.createElement("span");t.appendChild(n),n.className="icon-quill";var s=this.mval=document.createElement("span");s.className="movebtn-value",t.appendChild(s),s.innerHTML="0000";var o=this.ubtn=document.createElement("span");o.className="icon-undo",t.appendChild(o)},t.prototype.addCount=function(t){this.count+=t;for(var e=this.count,i=0,n="";e>=10;)i++,e/=10;i=4-i-1;for(var s=0;s<i;s++)n+="0";this.mval.innerHTML=n+this.count},t.prototype.reset=function(){this.count=0,this.mval.innerHTML="0000"},t.prototype.undo=function(){this.gh.gs.game3d.undo()},t}),i("rs/kp3d/ui/GameScreenHeader",["rs/kp3d/ui/HeaderTimeButton","rs/kp3d/ui/HeaderLevelButton","rs/kp3d/ui/HeaderMoveButton"],function(t,e,i){"use strict";function n(t){this.gs=t,this.init()}return n.prototype.init=function(){var n=this.el=document.createElement("div");n.className="rs-kp3d-gameheader",this.timeBtn=new t(this),n.appendChild(this.timeBtn.el),this.levelBtn=new e(this),n.appendChild(this.levelBtn.el),this.moveBtn=new i(this),n.appendChild(this.moveBtn.el)},n.prototype.getClientSize=function(){return[this.el.clientWidth,this.el.clientHeight]},n.prototype.show=function(){anime({targets:this.el,top:4,easing:"easeOutQuint",duration:800})},n.prototype.hide=function(){anime({targets:this.el,top:-60,easing:"easeOutQuint",duration:800})},n}),i("rs/utils/ObjectUtil",[],function(){"use strict";var t={merge:function(t,e,i){for(var n in t)"[object Object]"===Object.prototype.toString.call(t[n])?(void 0===e[n]&&(e[n]={}),this.merge(t[n],e[n])):e[n]=t[n];return e},clone:function(e,i){var n={};return t.merge(e,n,i),n}};return t}),i("rs/game3d/Firework3DState",[],function(){"use strict";return{EXPLODED:0,FALLING:1,EXPIRED:2}}),i("rs/game3d/Firework3D",["rs/utils/ObjectUtil","rs/game3d/Firework3DState"],function(t,e){"use strict";function i(i){this.config={launchHeight:300,sphereRadius:200,color:16763904,size:72,numParticles:24},i=i||{},t.merge(i,this.config),this.state=e.EXPLODED,this.init()}var n=[16777215,16776960,14352128,16711844,15990528];return i.prototype=Object.create(THREE.Points.prototype),i.prototype.constructor=i,i.prototype.init=function(){THREE.Points.prototype.constructor.call(this);var t=this.config;this.geometry=new THREE.Geometry;for(var e=this.geometry.vertices,i=0;i<t.numParticles;i++){var s=new THREE.Vector3;s.tX=2*Math.random()*t.sphereRadius-t.sphereRadius+50,s.tY=2*Math.random()*t.sphereRadius-t.sphereRadius+50,s.tZ=2*Math.random()*t.sphereRadius-t.sphereRadius+50,e.push(s)}this.geometry.verticesNeedUpdate=!0;var o=n[Math.floor(Math.random()*n.length)];this.material=new THREE.PointsMaterial({size:t.size,color:o,opacity:1,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1,map:t.map}),this.material.needsUpdate=!0},i.prototype.setRegion=function(t,e){this.regionWidth=t,this.regionHeight=e},i.prototype.update=function(t){var i=this.geometry.vertices;if(this.state==e.EXPLODED){for(var n=0;n<i.length;n++){var s=i[n];s.x+=.1*(s.tX-s.x),s.y+=.1*(s.tY-s.y),s.z+=.1*(s.tZ-s.z)}Math.abs(s.tX-s.x)<5&&(this.state=e.FALLING)}else{for(var o=-80*t,n=0;n<i.length;n++){var s=i[n];s.vy+=o,s.y+=s.vy}this.material.opacity+=.025*(0-this.material.opacity),this.material.opacity<=.05&&this.reset()}this.geometry.verticesNeedUpdate=!0},i.prototype.reset=function(){if(this.regionWidth){this.position.x=Math.random()*this.regionWidth-.5*this.regionWidth;var t=this.regionHeight-this.config.launchHeight;this.position.y=Math.random()*t-.5*t}this.state=e.EXPLODED,this.material.opacity=1,this.material.color.set(n[Math.floor(Math.random()*n.length)]),this.rotation.z=0;for(var i=this.geometry.vertices,s=this.config,o=0;o<i.length;o++){var r=i[o];r.x=r.y=r.z=r.vy=0,r.tX=2*Math.random()*s.sphereRadius-s.sphereRadius+50,r.tY=2*Math.random()*s.sphereRadius-s.sphereRadius+50,r.tZ=2*Math.random()*s.sphereRadius-s.sphereRadius+50}this.geometry.verticesNeedUpdate=!0,this.material.needsUpdate=!0,s.callback&&s.callback.call(this)},i}),i("rs/game3d/Firework3DSet",["rs/utils/ObjectUtil","rs/game3d/Firework3D","rs/game3d/Firework3DState"],function(t,e,i){"use strict";function n(e,i){this.g3d=e,this.config={numFireworks:3,interval:500},i=i||{},t.merge(i,this.config),this.init()}return n.prototype=Object.create(THREE.Group.prototype),n.prototype.constructor=n,n.prototype.init=function(){THREE.Group.prototype.constructor.call(this);for(var t=this.config,i=this.g3d.gs.kp3d.assetManager.fwTexture,n=0;n<t.numFireworks;n++){var s=new e({map:i,callback:t.callback});this.add(s)}},n.prototype.update=function(t){for(var e=0;e<this.children.length;e++){this.children[e].update(t)}},n.prototype.changeRegion=function(t,e){this.children.forEach(function(i){i.setRegion(t,e)})},n.prototype.reset=function(){this.children.forEach(function(t){t.reset()})},n}),i("rs/kp3d/GameLight",[],function(){"use strict";function t(t){this.g3d=t,this.dopt=t.dopt,this.speed=this.dopt.lightMovingSpeed,this.init()}t.prototype=Object.create(THREE.Group.prototype),t.prototype.constructor=t;return t.prototype.init=function(){THREE.Group.prototype.constructor.call(this),this.bound=[300,400,10],this.dirX=1;var t=this.lights=[];t[0]=new THREE.PointLight(16777215,.7,0),t[1]=new THREE.PointLight(16777215,.7,0),t[0].position.set(-200,600,-400),t[0].oZ=-400,t[1].position.set(150,200,300),t[1].oZ=680,this.add(t[0]),this.add(t[1]);var e=(this.g3d.scene,new THREE.PointLightHelper(t[0],5),new THREE.PointLightHelper(t[1],20),new THREE.AmbientLight(this.dopt.ambientLight,.8));this.add(e)},t.prototype.animate=function(){this.lights[1].position.x+=this.dirX*this.speed;var t=this.lights[1].position.x;(t>.5*this.bound[0]||t<.5*-this.bound[0])&&(this.dirX=-this.dirX)},t.prototype.transition=function(){},t.prototype.setBound=function(t,e){this.bound=t;var i=this.lights[1];i.position.set(.5*t[0],0,i.oZ)},t}),i("rs/utils/ImageUtil",["rs/utils/ObjectUtil"],function(t){"use strict";return{createReflection:function(t,e){if(void 0===t)throw"Invalid input image";void 0===e&&(e=[0,.5,.4,.25,1,0]);var i=t.width,n=t.height,s=document.createElement("canvas");s.width=i,s.height=n;for(var o=s.getContext("2d"),r=o.createLinearGradient(0,0,0,n),a=.5*e.length,h=0;h<a;h++)r.addColorStop(e[2*h],"rgba(0, 0, 0, "+e[2*h+1]+")");o.fillStyle=r,o.fillRect(0,0,i,n),o.globalCompositeOperation="source-in",o.translate(0,t.height),o.scale(1,-1),o.drawImage(t,0,0);var l=document.createElement("img");return l.src=s.toDataURL(),l}}}),i("rs/kp3d/PuzzlePiece",[],function(){"use strict";function t(t){this.pb=t,this.init()}return t.prototype=Object.create(THREE.Mesh.prototype),t.prototype.constructor=t,t.prototype.init=function(){THREE.Mesh.prototype.constructor.call(this);var t=this.pb.dopt;this.bevelScale=t.bevelScale,this.geometry=new THREE.BoxGeometry(100,100,20),this.widh=this.height=100,this.depth=20,this.ou=0,this.ov=0,this.tu=1,this.tv=1,this.bd=this.bdv=.5*(1-this.bevelScale),this.bd1=this.bdv1=1-this.bd;var e=new THREE.MeshPhongMaterial({specular:t.pieceSpecular,color:t.pieceColor,emissive:t.pieceEmissive,side:THREE.FrontSide});this.material=e},t.prototype.modifyGeometry=function(t,e,i){this.width=t,this.height=e,this.depth=i;var n=this.geometry,s=n.vertices,o=.5*t,r=.5*e,a=.5*i,h=this.bevelScale,l=o*h,c=r*h;s[0].x=l,s[0].y=c,s[0].z=a,s[1].x=o,s[1].y=r,s[1].z=-a,s[2].x=l,s[2].y=-c,s[2].z=a,s[3].x=o,s[3].y=-r,s[3].z=-a,s[4].x=-o,s[4].y=r,s[4].z=-a,s[5].x=-l,s[5].y=c,s[5].z=a,s[6].x=-o,s[6].y=-r,s[6].z=-a,s[7].x=-l,s[7].y=-c,s[7].z=a,n.verticesNeedUpdate=!0;var n=this.geometry,p=n.faceVertexUvs[0],d=this.ou,u=this.ov,m=this.tu,f=this.tv,g=this.bd,v=this.bd1,y=this.bdv,b=this.bdv1;p[0][0].x=d+v,p[0][0].y=u+b,p[0][1].x=d+v,p[0][1].y=u+y,p[0][2].x=m,p[0][2].y=f,p[1][0].x=d+v,p[1][0].y=u+y,p[1][1].x=m,p[1][1].y=d,p[1][2].x=m,p[1][2].y=f,p[2][0].x=d,p[2][0].y=f,p[2][1].x=d,p[2][1].y=u,p[2][2].x=d+g,p[2][2].y=u+b,p[3][0].x=d,p[3][0].y=u,p[3][1].x=d+g,p[3][1].y=u+y,p[3][2].x=d+g,p[3][2].y=u+b,p[4][0].x=d,p[4][0].y=f,p[4][1].x=d+g,p[4][1].y=u+b,p[4][2].x=m,p[4][2].y=f,p[5][0].x=d+g,p[5][0].y=u+b,p[5][1].x=d+v,p[5][1].y=u+b,p[5][2].x=m,p[5][2].y=f,p[6][0].x=d+g,p[6][0].y=u+y,p[6][1].x=d,p[6][1].y=u,p[6][2].x=d+v,p[6][2].y=u+y,p[7][0].x=d,p[7][0].y=u,p[7][1].x=m,p[7][1].y=u,p[7][2].x=d+v,p[7][2].y=u+y,p[8][0].x=d+g,p[8][0].y=u+b,p[8][1].x=d+g,p[8][1].y=u+y,p[8][2].x=d+v,p[8][2].y=u+b,p[9][0].x=d+g,p[9][0].y=u+y,p[9][1].x=d+v,p[9][1].y=u+y,p[9][2].x=d+v,p[9][2].y=u+b,p[10][0].x=m,p[10][0].y=f,p[10][1].x=m,p[10][1].y=u,p[10][2].x=d,p[10][2].y=f,p[11][0].x=m,p[11][0].y=u,p[11][1].x=d,p[11][1].y=u,p[11][2].x=d,p[11][2].y=f,n.uvsNeedUpdate=!0},t.prototype.updateBevel=function(t){this.bevelScale=t,this.bd=.5*(1-this.bevelScale)*this.nhs,this.bd1=this.nhs-this.bd,this.bdv=.5*(1-this.bevelScale)*this.vhs,this.bdv1=this.vhs-this.bdv,this.modifyGeometry(this.width,this.height,this.depth)},t.prototype.tweenBevel=function(t){var e=this,i={value:this.bevelScale};e.updateBevel(t),anime({targets:i,value:t,easing:"easeOutQuint",duration:800,update:function(){e.updateBevel(i.value)}})},t.prototype.updateTexturePosition=function(t,e,i,n){this.index=t;var s=n.image.width,o=n.image.height,r=this.pb.dopt.pieceDepth,a=Math.floor(t/i),h=t%i,l=e-a-1,c=h,p=1/i,d=1/e,u=c*p,m=l*d,f=u+p,g=m+d;this.ou=u,this.ov=m,this.tu=f,this.tv=g,this.nhs=p,this.vhs=d,this.bd=.5*(1-this.bevelScale)*p,this.bd1=p-this.bd,this.bdv=.5*(1-this.bevelScale)*d,this.bdv1=d-this.bdv,this.modifyGeometry(s/i,o/e,r),this.setTexture(n)},t.prototype.setTexture=function(t){this.material.map=t,this.material.needsUpdate=!0},t}),i("rs/kp3d/PuzzlePiecePool",["rs/kp3d/PuzzlePiece"],function(t){"use strict";function e(t){this.pb=t,this.init()}return e.prototype.init=function(){this.pool=[];for(var e=this.pb,i=0;i<10;i++){var n=new t(e);this.pool.push(n)}},e.prototype.obtain=function(){if(this.pool.length>0){var e=this.pool.pop();return e}var e=new t(this.pb);return e},e.prototype.free=function(t){this.pool.push(t)},e}),i("rs/kp3d/PuzzleBoard",["rs/kp3d/PuzzlePiece","rs/kp3d/PuzzlePiecePool"],function(t,e){"use strict";function i(t){this.g3d=t,this.dopt=t.dopt,this.init()}i.prototype=Object.create(THREE.Group.prototype),i.prototype.constructor=i;return i.prototype.init=function(){function t(){var t=new THREE.BoxBufferGeometry(10,10,10),e=new THREE.MeshPhongMaterial({specular:i.pieceSpecular,color:i.pieceColor,emissive:i.pieceEmissive,side:THREE.FrontSide}),s=new THREE.Mesh(t,e);return n.add(s),s}THREE.Group.prototype.constructor.call(this);var i=this.dopt,n=(this.g3d.kp3d.assetManager,this);this.pool=new e(this),this.pieces=[],this.topBoard=t(),this.leftBoard=t(),this.rightBoard=t(),this.bottomBoard=t(),this.backBoard=t(),this.visible=!1},i.prototype.applyImage=function(t,e,i,n){var s=new THREE.TextureLoader,o=this,r=this.pool;this.row=e,this.column=i,s.load(t,function(t){var s,a,h=o.pieces,l=t.image.width,c=t.image.height,p=l/i,d=c/e;p>d?(s=p*i,a=p*e):(a=d*e,s=d*i),t.minFilter=THREE.LinearFilter,o.imageWidth=s,o.imageHeight=a;for(var u=o.prepareImage(t.image,s,a),m=new THREE.CanvasTexture(u),f=e*i,g=0;g<f;g++){var v;h[g]?v=h[g]:(v=r.obtain(),h.push(v),o.add(v)),v.bevelScale=o.dopt.bevelScale,v.updateTexturePosition(g,e,i,m)}for(var g=f;g<h.length;g++){var v=h[g];o.remove(v),r.free(v)}h.splice(f),o.arrangePieces(),o.arrangeBoard(),o.visible=!0;var y=o.g3d.kp3d.assetManager,b=y.boardTextures[Math.floor(Math.random()*y.boardTextures.length)];o.updateBoardTexture(b),n&&n.call(o.g3d)})},i.prototype.applyNumberImage=function(t,e,i){var n=(this.dopt,this),s=this.pieces,o=Math.floor(1e3/Math.max(t,e)),r=o*e,a=o*t,h=this.pool;this.row=t,this.column=e;var l=this.getPaddingPattern(),c=document.createElement("canvas");c.width=r,c.height=a;var p=c.getContext("2d"),d=p.createPattern(l,"repeat");p.fillStyle=d,p.fillRect(0,0,r,a);var u=o/2.5;p.font=u+"px Arial",p.fillStyle="white",p.textAlign="center";for(var m=.5*o,f=0;f<t;f++)for(var g=0;g<e;g++)p.fillText(f*e+g+1,g*o+m,f*o+m+.4*u);n.dataUrl=c.toDataURL(),n.imageWidth=r,n.imageHeight=a;for(var v=new THREE.CanvasTexture(c),y=t*e,f=0;f<y;f++){var b;s[f]?b=s[f]:(b=h.obtain(),s.push(b),n.add(b)),b.bevelScale=n.dopt.bevelScale,b.updateTexturePosition(f,t,e,v)}for(var f=y;f<s.length;f++){var b=s[f];n.remove(b),h.free(b)}s.splice(y),n.arrangePieces(),n.arrangeBoard(),n.visible=!0;var w=n.g3d.kp3d.assetManager,k=w.boardTextures[Math.floor(Math.random()*w.boardTextures.length)];n.updateBoardTexture(k),i&&i.call(n.g3d)},i.prototype.getPaddingPattern=function(){var t=this.g3d.kp3d.assetManager.padSet;return t[Math.floor(Math.random()*t.length)]},i.prototype.arrangePieces=function(){this.parray=[],this.moveStack=[];for(var t=0;t<this.pieces.length;t++){var e=this.pieces[t],i=Math.floor(t/this.column),n=t%this.column,s=this.calPosition(i,n);e.position.set(s[0],s[1],0),e.visible=!0,e.pindex=t,this.parray.push(t)}this.pieces[this.pieces.length-1].visible=!1,this.pieces[this.pieces.length-1].position.z=-100,this.parray[this.parray.length-1]=-1},i.prototype.calPosition=function(t,e){function i(t){return Math.abs(t)<1e-4?0:t}var n=this.imageWidth,s=this.imageHeight,o=n/this.column+0,r=n-o,a=s-o,h=.5*-r,l=.5*a,c=h+e*o,p=l-t*o;return c=i(c),p=i(p),[c,p]},i.prototype.movePiece=function(t){function e(t,e){return t!=s&&-1!=t&&e!=o&&-1!=e&&(-1==l[t*o+e]||void 0)}function i(e,i){var s=e*o+i,r=t.pindex;t.pindex=s,c.push([r,s]);var a=n.calPosition(e,i),h=a[0],p=a[1];anime.remove(t.position),anime({targets:t.position,x:h,y:p,easing:"easeOutQuint",duration:800}),l[r]=-1,l[s]=t.index,n.g3d.gs.header.moveBtn.addCount(1)}var n=this,s=this.row,o=this.column,r=t.pindex,a=Math.floor(r/o),h=r%o,l=this.parray,c=this.moveStack;return e(a-1,h)?(i(a-1,h),!0):e(a+1,h)?(i(a+1,h),!0):e(a,h-1)?(i(a,h-1),!0):!!e(a,h+1)&&(i(a,h+1),!0)},i.prototype.undo=function(){if(0==this.moveStack.length)return!1;for(var t=this.moveStack.pop(),e=0;e<this.pieces.length;e++){var i=this.pieces[e];if(i.pindex==t[1]){var n=Math.floor(t[0]/this.column),s=t[0]%this.column,o=this.calPosition(n,s),r=o[0],a=o[1];return i.pindex=t[0],anime.remove(i.position),anime({targets:i.position,x:r,y:a,easing:"easeOutQuint",duration:800}),this.parray[t[1]]=-1,this.parray[t[0]]=i.index,this.g3d.kp3d.assetManager.piecemove.play(),!0}}},i.prototype.updateBoardTexture=function(t){this.topBoard.material.map=t,this.topBoard.material.needsUpdate=!0,this.bottomBoard.material.map=t,this.bottomBoard.material.needsUpdate=!0,this.leftBoard.material.map=t,this.leftBoard.material.needsUpdate=!0,this.rightBoard.material.map=t,this.rightBoard.material.needsUpdate=!0,this.backBoard.material.map=t,this.backBoard.material.needsUpdate=!0},i.prototype.prepareImage=function(t,e,i){var n=(this.dopt,this.getPaddingPattern()),s=document.createElement("canvas");s.width=e,s.height=i;var o=s.getContext("2d"),r=t.width/t.height;e/r>i?(t.height=i,t.width=i*r):(t.width=e,t.height=e/r);var a=.5*(e-t.width),h=.5*(i-t.height),l=o.createPattern(n,"repeat");return o.fillStyle=l,o.fillRect(0,0,e,i),o.drawImage(t,a,h,t.width,t.height),s},i.prototype.arrangeBoard=function(){var t=this.dopt,e=t.boardThickness,i=t.boardDepth,n=this.imageWidth,s=this.imageHeight,o=n+2*e,r=e,a=t.pieceDepth+i;this.topBoard.scale.set(o/10,r/10,a/10),this.topBoard.position.set(0,.5*s+.5*e,.5*-i),this.bottomBoard.scale.set(o/10,r/10,a/10),this.bottomBoard.position.set(0,.5*-s-.5*e,.5*-i),o=e,r=s,this.leftBoard.scale.set(o/10,r/10,a/10),this.leftBoard.position.set(.5*-n-.5*e,0,.5*-i),this.rightBoard.scale.set(o/10,r/10,a/10),this.rightBoard.position.set(.5*n+.5*e,0,.5*-i),this.backBoard.scale.set(n/10,s/10,i/10),this.backBoard.position.set(0,0,.5*-a)},i.prototype.getScaleFitPosition=function(t,e){var i,n=this.dopt,s=this.getBound(),o=s[0],r=s[1],a=s[2],h=n.fitFactor||.98,l=o/r;i=t/l>e?e*h/r:t*h/o;var c=this.g3d.camera.position.z;return c-c/i-.5*a},i.prototype.getBound=function(){var t=this.dopt,e=this.imageWidth,i=this.imageHeight;return[e+2*t.boardThickness,i+2*t.boardThickness,t.pieceDepth+t.boardDepth]},i.prototype.shuffle=function(){var t=this.row,e=this.column,i=this.g3d.kp3d.pref,n=this.g3d.kp3d.config,s=n.general.moveIteration,o=s[i.data.difficulty]+2*this.g3d.gs.currentLevel;console.log("Total moves: "+o),this.parray=function(){for(var i=[],n=0;n<t;n++){i[n]=[];for(var s=0;s<e;s++)i[n][s]=n*e+s}i[t-1][e-1]=-1;for(var r=t-1,a=e-1,h=[[-1,0],[0,1],[1,0],[0,-1]],l=0;l<o;l++){for(var c=Math.floor(4*Math.random());r+h[c][0]<0||r+h[c][0]==t||a+h[c][1]<0||a+h[c][1]==e;)c=Math.floor(4*Math.random());var p=r+h[c][0],d=a+h[c][1];i[r][a]=i[p][d],i[p][d]=-1,r=p,a=d}for(var u=[],n=0;n<i.length;n++)u=u.concat(i[n]);return u}(),this.moveStack=[];for(var r=0;r<this.pieces.length;r++)for(var a=this.pieces[r],h=0;h<this.parray.length;h++)if(this.parray[h]==a.index){a.pindex=h;var l=Math.floor(h/this.column),c=h%this.column,p=this.calPosition(l,c),d=p[0],u=p[1];anime({targets:a.position,keyframes:[{z:600*Math.random()+25},{z:0,x:d,y:u}],easing:"easeOutQuint",duration:1200,delay:250}),anime({targets:a.rotation,keyframes:[{z:Math.PI},{z:0}],easing:"easeOutQuint",duration:1200,delay:250});break}},i.prototype.isWon=function(){for(var t=0;t<this.pieces.length;t++){var e=this.pieces[t];if(e.pindex!==e.index)return!1}return!0},i.prototype.tweenBevel=function(t){for(var e=0;e<this.pieces.length;e++){this.pieces[e].tweenBevel(t)}},i.prototype.completeBoard=function(){var t=this.pieces[this.pieces.length-1];t.visible=!0,anime({targets:t.position,z:[2e3,0],easing:"easeOutQuint",duration:800}),this.tweenBevel(1),anime({targets:this.rotation,y:[0,Math.PI/6,-Math.PI/6,0],easing:"easeOutQuad",delay:200,duration:1e3})},i}),i("rs/kp3d/Game3dContainer",["rs/utils/ImageUtil","rs/kp3d/PuzzleBoard","rs/kp3d/GameLight"],function(t,e,i){"use strict";function n(t){this.g3d=t,this.init()}n.prototype=Object.create(THREE.Group.prototype),n.prototype.constructor=n;return n.prototype.init=function(){THREE.Group.prototype.constructor.call(this),this.puzzleBoard=new e(this.g3d),this.add(this.puzzleBoard);var t=this.glight=new i(this.g3d);this.add(t)},n.prototype.fitPuzzleBoard=function(){var t=this.g3d.gs,e=this.g3d.dopt,i=t.header.getClientSize(),n=t.bbar.getClientSize(),s=this.g3d.el.clientHeight,o=this.g3d.el.clientWidth,r=o,a=s-i[1]-n[1]-10;r>e.boardMaxWidth&&(r=e.boardMaxWidth),a>e.boardMaxHeight&&(a=e.boardMaxHeight),this.g3d.setCameraMatchProjection();var h=this.puzzleBoard.getScaleFitPosition(r,a);this.position.z=h,this.glight.setBound(this.puzzleBoard.getBound())},n.prototype.show=function(){this.visible=!1,this.fitPuzzleBoard();var t=this.position.z;this.position.z=t-1e3,this.rotation.y=.5*Math.PI;var e=this;anime.remove(this.position),anime({targets:this.position,z:t,easing:"easeOutQuad",duration:1200}),anime.remove(this.rotation),anime({targets:this.rotation,y:2*Math.PI,easing:"easeOutCubic",duration:1500,complete:function(){setTimeout(function(){e.g3d.shuffle()},300)}}),setTimeout(function(){e.visible=!0},140)},n.prototype.shuffle=function(){var t=this.position.z,e=this.position.z-400,i=this.g3d.kp3d.assetManager;this.isShuffling=!0;var n=this;setTimeout(function(){i.shufflestart.play()},250),setTimeout(function(){i.shuffleend.play()},1e3),anime({targets:this.position,keyframes:[{z:e,duration:1200},{z:t,delay:100,duration:1e3}],easing:"easeOutQuint",duration:1200,complete:function(){n.isShuffling=!1}}),anime({targets:this.rotation,keyframes:[{x:-Math.PI/3,duration:1200},{x:0,delay:100,duration:1200}],easing:"easeOutQuint"}),this.puzzleBoard.shuffle()},n}),i("rs/kp3d/Game3d",["rs/three/BaseApp","rs/utils/ObjectUtil","rs/utils/BrowserUtil","rs/game3d/Firework3DSet","rs/kp3d/GameLight","rs/kp3d/Game3dContainer"],function(t,e,i,n,s,o){"use strict";function r(e){this.gs=e,this.config=e.config,this.kp3d=e.kp3d,this.dopt=this.kp3d.defaultOptions,this.am=this.kp3d.assetManager;t.prototype.constructor.call(this,500,300),this.setCameraMatchProjection(),this.defaultCursor="auto",this.buildScene()}r.prototype=Object.create(t.prototype),r.prototype.constructor=r;var a={RUNNING:0,WON:1};return r.prototype.enableOrbitControl=function(){this.controls=new OrbitControls(this.camera,this.el),this.controls.enableDamping=!0},r.prototype.buildScene=function(){this.container=new o(this),this.clock=new THREE.Clock;var t=this.scene;t.add(this.container);var e=this.am;this.f3ds=new n(this,{numParticles:3,callback:function(){e.firework.play()}}),t.add(this.f3ds),this.setRunningState(),this._setUpRaycaster(),this.resizeHandler()},r.prototype._setUpRaycaster=function(){function t(t){var i,p;t.touches?(i=t.touches[0].clientX,p=t.touches[0].clientY):t.changedTouches?(i=t.changedTouches[0].clientX,p=t.changedTouches[0].clientY):(i=t.offsetX,p=t.offsetY);var d={x:i/r.width*2-1,y:-p/r.height*2+1};n.setFromCamera(d,e);for(var u=n.intersectObjects(s.children,!0),m=0;m<u.length;m++){var f=u[m].object;if(void 0==f.index)break;if(t.type==c.mdown&&-1!==f.index&&r.isRunningState()){l.movePiece(f)&&(h.piecemove.play(),l.isWon()&&(r.state=a.WON,l.completeBoard(),setTimeout(function(){r.setWonState()},1e3)))}t.type==c.mmove&&(o.style.cursor="pointer");break}0==u.length&&t.type==c.mmove&&(o.style.cursor=r.defaultCursor)}var e=this.camera,n=this.raycaster,s=this.container,o=this.el,r=this,h=this.am,l=this.container.puzzleBoard,c=i.getMouseTouchEvents();o.addEventListener(c.mdown,t),o.addEventListener(c.mmove,t)},r.prototype.loadLevel=function(t,e){this.setRunningState();var i=this.gs.levels[this.gs.currentCategory];t==i.content.length&&(t=0);var n=i.content[t],s=n.board.split("x"),o=Number.parseInt(s[0]),r=Number.parseInt(s[1]),a=this;this.container.visible=!1,n.path?this.container.puzzleBoard.applyImage(n.path,o,r,function(){a.container.show(),e.call(a)}):this.container.puzzleBoard.applyNumberImage(o,r,function(){a.container.show(),e.call(a)})},r.prototype._renderRequest=function(){t.prototype._renderRequest.call(this);var e=this.clock.getDelta();this.controls&&this.controls.update(),this.container.glight.animate(),this.state==a.WON&&this.f3ds.update(e)},r.prototype.setRunningState=function(){this.state=a.RUNNING,this.f3ds.visible=!1,this.gs.header.show()},r.prototype.isRunningState=function(){return this.state==a.RUNNING},r.prototype.setWonState=function(){this.state=a.WON,this.f3ds.visible=!0,this.f3ds.reset(),this.gs.header.timeBtn.pause(),this.gs.header.hide(),this.gs.showWonBar(),this.am.wintune.play(),this.gs.unlockNextLevel()},r.prototype.resize=function(t,e){this.width=t,this.height=e,this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e),this.resizeHandler(),this.container.fitPuzzleBoard(),this.f3ds.changeRegion(t,e)},r.prototype.resizeHandler=function(e){t.prototype.resizeHandler.call(this),this.setCameraMatchProjection()},r.prototype.show=function(){this.el.style.display="block"},r.prototype.hide=function(){this.el.style.display="none"},r.prototype.shuffle=function(){this.isRunningState()&&(this.container.isShuffling||(this.container.shuffle(),this.gs.reset()))},r.prototype.undo=function(){if(this.isRunningState()){this.container.puzzleBoard.undo()&&this.gs.header.moveBtn.addCount(-1)}},r.prototype.destroy=function(){},r}),i("rs/kp3d/screen/GameScreen",["rs/game/ImagePanel","rs/kp3d/ui/TrophyPanel","rs/kp3d/ui/LevelPanel","rs/kp3d/ui/CategoryPanel","rs/kp3d/ui/HelpPanel","rs/kp3d/ui/GameScreenButtonBar","rs/kp3d/ui/GameScreenWonBar","rs/kp3d/ui/GameScreenHeader","rs/kp3d/Game3d"],function(t,e,i,n,s,o,r,a,h){"use strict";function l(t,e){this.kp3d=t,this.config=t.config,this.init()}return l.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-gscreen",t.style.width=t.style.height="100%",t.style.display="none";var e=this.config.data.level;this.levels=[];for(var i in e)this.levels.push({name:i,content:e[i]});this.initPanel(),this.header=new a(this),t.appendChild(this.header.el),this.bbar=new o(this),t.appendChild(this.bbar.el),this.wbar=new r(this),t.appendChild(this.wbar.el),this.game3d=new h(this),t.appendChild(this.game3d.el),this.currentLevel=0},l.prototype.initPanel=function(){this.imagePanel=new t,this.trophyPanel=new e(this),this.levelPanel=new i(this),this.catPanel=new n(this),this.kp3d.homeScreen?this.hpanel=this.kp3d.homeScreen.hpanel:this.hpanel=new s},l.prototype.loadLevel=function(t){function e(){i.kp3d.hidePreloader(),i.reset(),i.header.levelBtn.setLevel(t+1),i.header.timeBtn.resume()}var i=this;this.trophyPanel.hide(),this.levelPanel.hide(),this.catPanel.hide(),this.showButtonBar(),this.kp3d.showPreloader(),this.game3d.loadLevel(t,e),this.currentLevel=t},l.prototype.loadCategory=function(t){this.currentCategory=t,this.loadLevel(0)},l.prototype.replayLevel=function(){this.loadLevel(this.currentLevel)},l.prototype.nextLevel=function(){var t=this.currentLevel+1;t==this.levels[this.currentCategory].content.length&&(t=0),this.loadLevel(t)},l.prototype.unlockNextLevel=function(){var t=this.currentLevel+1,e=this.levels[this.currentCategory];t<e.content.length&&this.kp3d.pref.saveUnlock(e.name,t)},l.prototype.getCurrentImagePath=function(){var t=this.levels[this.currentCategory],e=t.content[this.currentLevel].path;return void 0==e&&(e=this.game3d.container.puzzleBoard.dataUrl),e},l.prototype.reset=function(){this.header.timeBtn.reset(),this.header.moveBtn.reset()},l.prototype.show=function(t){this.currentCategory=this.kp3d.pref.data.defaultCategory,this.kp3d.root.appendChild(this.el),this.transitionIn();var e=this.kp3d.getAppDimension();this.game3d.resize(e[0],e[1]),this.game3d.startRendering(),void 0==t&&(t=0),this.loadLevel(0)},l.prototype.hide=function(){this.kp3d.root.removeChild(this.el),this.game3d.stopRendering()},l.prototype.showWonBar=function(){this.bbar.hide();var t=this.wbar;setTimeout(function(){t.show()},400)},l.prototype.showButtonBar=function(){this.wbar.hide();var t=this.bbar;setTimeout(function(){t.show()},400)},l.prototype.transitionIn=function(){this.el.style.display="block"},l.prototype.transitionOut=function(){},l.prototype.getMoveCount=function(){return this.header.moveBtn.count},l.prototype.getPlayingTime=function(){return this.header.timeBtn.currentTime},l.prototype.resize=function(t,e){this.game3d.resize(t,e)},l.prototype.dispose=function(){},l}),i("rs/kp3d/screen/LevelScreen",[],function(){"use strict";function t(t,e){this.kp3d=t,this.config=t.config,this.init()}return t.prototype.init=function(){var t=this.el=document.createElement("div");t.className="rs-lscreen",t.style.width=t.style.height="100%",t.style.display="none",this.kp3d.root.appendChild(t)},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.resize=function(){},t}),i("rs/utils/MouseUtil",["rs/utils/BrowserUtil"],function(t){"use strict";function e(t){t.preventDefault(),t.currentTarget.mouseWheelCallback.call(t.currentTarget.mousewheelContext,Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)))}return{touchClick:function(e,i){t.isMobile()?e.addEventListener("touchstart",i):e.addEventListener("click",i)},removeTouchClick:function(e,i){t.isMobile()?e.removeEventListener("touchstart",i):e.removeEventListener("click",i)},startMouseWheel:function(t,i,n){t.mouseWheelCallback=i,t.mousewheelContext=n,t.addEventListener("DOMMouseScroll",e,!1),t.addEventListener("mousewheel",e,!1)},stopMouseWheel:function(t){t.removeEventListener("DOMMouseScroll",e),t.removeEventListener("mousewheel",e)},swipeStart:function(e,i,n,s,o){function r(t){u=t.clientX,m=t.clientY,f=(new Date).getTime(),e.addEventListener("mousemove",h),window.addEventListener("mouseup",l)}function a(t){e.removeEventListener("mousemove",h),window.removeEventListener("mouseup",l),e.removeEventListener("mouseout",a)}function h(e){var i=e.clientX-u,r=e.clientY-m;t.swipeState="move",Math.abs(i)>Math.abs(r)?s(i*n):o(r*n)}function l(t){e.removeEventListener("mousemove",h),window.removeEventListener("mouseup",l)}function c(t){u=t.touches[0].clientX,m=t.touches[0].clientY,f=(new Date).getTime(),e.addEventListener("touchmove",p),window.addEventListener("touchend",d)}function p(e){e.preventDefault();var i=e.changedTouches[0].clientX-u,r=e.changedTouches[0].clientY-m;t.swipeState="move",Math.abs(i)>Math.abs(r)?s(i*n):o(r*n)}function d(t){e.removeEventListener("touchmove",p),window.removeEventListener("touchend",d)}var u,m,f;e.style[t.getPrefix()+"UserSelect"]="none",e.removeTracking=function(){e.removeEventListener("mousedown",r),window.removeEventListener("mouseup",l),e.removeEventListener("mousemove",h),e.removeEventListener("mouseout",a),e.removeEventListener("touchstart",c),e.removeEventListener("touchend",d),e.removeEventListener("touchmove",p),e.removeTracking=null},t.isMobile()?e.addEventListener("touchstart",c):e.addEventListener("mousedown",r)},swipeStop:function(e){e.style[t.getPrefix()+"UserSelect"]="all",e.removeTracking&&e.removeTracking()}}}),i("rs/kp3d/FullscreenButton",["rs/utils/BrowserUtil","rs/utils/MouseUtil"],function(t,e){"use strict";function i(t,e){this.targetEl=t,this.build("icon-screen-full",e)}return i.prototype.build=function(i,n){var s=this,o=this.targetEl,r=this.el=document.createElement("span");r.className=i+" rs-kp3d-fsbtn",e.touchClick(r,function(e){t.isFullscreen()?t.exitFullscreen(o):t.goFullscreen(o)}),t.fullScreenCallback(o,function(){t.isFullscreen()?s.setFull():s.setNormal(),n.call(o)})},i.prototype.setFull=function(){this.el.classList.remove("icon-screen-full"),this.el.classList.add("icon-screen-normal")},i.prototype.setNormal=function(){this.el.classList.remove("icon-screen-normal"),this.el.classList.add("icon-screen-full")},i}),i("rs/ui/RingPreloader",["rs/utils/ObjectUtil"],function(t){"use strict";function e(e){this.dopt={size:40,borderWidth:6,borderColor:"#AAA"},t.merge(e,this.dopt),this.build()}return e.prototype.build=function(){var t=this.dopt,e=this.el=document.createElement("div");e.className="rs-ringpreloader",e.innerHTML="<div class='lds-ring'><div></div><div></div><div></div><div></div></div>",e.style.marginLeft=e.style.marginTop=.5*-t.size+"px";for(var i=e.firstChild.children,n=0;n<i.length;n++){var s=i[n].style;s.width=s.height=t.size+"px",s.borderWidth=t.borderWidth+"px",s.borderTopColor=t.borderColor}},e.prototype.show=function(){this.el.style.display="block"},e.prototype.hide=function(){this.el.style.display="none"},e}),i("rs/kp3d/KidSliding",["rs/three/BaseApp","rs/kp3d/Preferences","rs/kp3d/AssetManager","rs/kp3d/screen/HomeScreen","rs/kp3d/screen/GameScreen","rs/kp3d/screen/LevelScreen","rs/kp3d/FullscreenButton","rs/ui/RingPreloader","rs/utils/ObjectUtil","rs/utils/MouseUtil","rs/utils/BrowserUtil"],function(t,e,i,n,s,o,r,a,h,l,c){"use strict";function p(t,e){this.loadConfig(),this.isMobile=c.isMobile(),this.isMobile?(d="touchstart",u="touchend",m="touchmove"):(d="mousedown",u="mouseup",m="mousemove"),this.mevents={mdown:d,mup:u,mmove:m},this.defaultOptions={bevelScale:.96,pieceDepth:22,pieceSpecular:1118481,pieceEmissive:1118481,pieceColor:16777215,boardThickness:20,boardDepth:16,boardMaxWidth:780,boardMaxHeight:780,fitFactor:.96,ambientLight:5592405,lightMovingSpeed:2},e=e||{},h.merge(e,this.defaultOptions),this.root=t,c.css(this.root,{position:"relative",display:"block",overflow:"hidden"});var i=this;window.addEventListener("resize",function(t){i.resize()}),document.body.addEventListener("click",function(t){})}var d,u,m;c.getPrefix();return p.prototype.loadConfig=function(){var t=this,e=new XMLHttpRequest;e.addEventListener("load",function(e){var i=JSON.parse(this.response);t.config=i,t.initComponents()}),e.open("GET","config.json"),e.send()},p.prototype.initComponents=function(){var t=this;this.defaultOptions,this.config;this.initPreferences(),this.initPreloader(),this.activeScreen=null,this.assetManager=new i(this),this.setHomeScreen(),setTimeout(function(){t.resize()},200)},p.prototype.initPreferences=function(){this.pref=new e(this.config,localStorage.getItem("kp3d"))},p.prototype.initPreloader=function(){var t=new a({borderColor:"#ccc"}),e=t.el;this.preloader=e,e.style.top="50%"},p.prototype.showPreloader=function(){this.root.appendChild(this.preloader)},p.prototype.hidePreloader=function(){
this.root.contains(this.preloader)&&this.root.removeChild(this.preloader)},p.prototype.initFullcreen=function(){this.fsbtn=new r(this.root,function(t){console.log("fullsceen change")}),this.root.appendChild(this.fsbtn.el)},p.prototype.addEventListener=function(t,e){this.root.addEventListener(t,e)},p.prototype.setScreen=function(t){this.activeScreen&&this.activeScreen.hide(),t.show(),this.activeScreen=t},p.prototype.setGameScreen=function(){this.gameScreen||(this.gameScreen=new s(this)),this.setScreen(this.gameScreen)},p.prototype.setHomeScreen=function(){this.homeScreen||(this.homeScreen=new n(this)),this.setScreen(this.homeScreen)},p.prototype.dispose=function(){},p.prototype.resize=function(){var t=this.getAppDimension(),e=t[0],i=t[1];this.activeScreen&&this.activeScreen.resize(e,i)},p.prototype.getAppDimension=function(){var t=c.computeStyle,e=t(this.root,"borderTopWidth");return[t(this.root,"width")-2*e,t(this.root,"height")-2*e]},p}),window.KidSliding=e("rs/kp3d/KidSliding")}();